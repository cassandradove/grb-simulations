# COSI GRB Group Simulations

This repo contains the code and inputs for COSI GRB simulations, as well as other short-duration transients which will need to be classified and investigated by the GRB group.

'examples/' contains sample .yaml files needed for 'sample_source_file_generation.py'. See the README file in 'examples/' for more details.

'MEGAlib_backgrounds/' contains the large simulated background files for COSI SMEX. These will be generated by Andreas or Eliza separate from the signal simulation files. A signal, or a sample of signals, will be placed on part of the background files to enable a full simulation. Background simulations can be found [here](https://drive.google.com/drive/folders/1OTN-_8gUxedueEbL3mPeh0_0kh7e9kKF).

'MEGAlib_outputs/' contains the final output of MEGAlib simulations. These will be lightcurve, image (localization), and event files. These visualization files and event files will be useful for testing the GRB trigger, and in informing the data challenge. There will be subdirectories labeled by the sample runs that have come out, e.g. 'data_challenge_1/'.

'MEGAlib_source_files/' contains the full set of source files passed to MEGAlib for a given simulation set. 

'MEGAlib_source_inputs/' contains the information necessary to generate a given simulation set in COSI. This is sub-divided into folders by event type, currently including gamma-ray bursts (grbs), magnetar giant flares (mgfs), soft gamma-ray repeater short bursts (sgr bursts), solar flares (solar_flares), and terrestrial gamma-ray flashses (tgfs). Each of these is further subdivided into the specific input samples generated by various team members. These will generally be spectral (.dat/.yaml) and lightcurve (.dat) files, as well as relevant images (.pdf, .png, etc). Each of these individual samples should contain a text or catalog file describing the sample as well as the responsible team member. For use with 'sample_source_file_generation.py', spectral files must be in the form 'event-name_spectrum.dat' or 'event-name_spectrum.yaml' and lightcurves must be in the form 'event-name_lightcurve.dat'.

'trigger_inputs/' contains the information necessary to test the COSI on-board trigger algorithm, generated by conversion of 'MEGAlib_outputs/' event files.

'sample_source_file_generation.py' will create source file samples based an on an input .yaml file. This will draw lightcurves and spectra from the samples in 'MEGAlib_source_inputs/' and create the .source files in 'MEGAlib_source_files/'. This draws lightcurves and spectra from the 'input_path/event_type/event_subtype' directory and creates .source files in 'output_path/event_type/event_subtype' with the defined mass model path and fluxes and incidence angles randomly chosen between the given values. Currently, this only produces .source files in detector coordinates, but the ability to create .source files in Galactic coordinates with orientation files will be added later.  
To run from the command line: `python sample_source_file_generation.py -y input-file.yaml`.

'trigger_algorithm_list_generation.py' creates event lists with the time and energy of each hit in the BGO and GeDs based on an input .yaml file. This draws source simulations from 'MEGAlib_outputs/' and background simulations from 'MEGAlib_backgrounds/' and creates the files in 'trigger_inputs/'.        
To run from the command line: `python trigger_algorithm_list_generation.py -y input-file.yaml`.